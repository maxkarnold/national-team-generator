<div class="flex flex-col items-center">
  <!-- DRAFT FORM -->
  <form class="flex flex-col w-full max-w-96 sm:w-2/5" [formGroup]="draftForm" *ngIf="!draftStarted">
    <label class="form-control w-full max-w-xs m-2 self-center">
      <div class="label">
        <span class="label-text">Selected Patch</span>
      </div>
      <select class="select select-bordered" formControlName="patchVersion">
        <option selected>MSI 24</option>
      </select>
    </label>

    <div class="form-control">
      <label class="label cursor-pointer flex justify-center">
        <span class="label-text">Blue Side</span>
        <input type="checkbox" class="toggle mx-2" formControlName="isRedSide" />
        <span class="label-text">Red Side</span>
      </label>
    </div>

    <div class="form-control">
      <label class="label cursor-pointer flex justify-center">
        <span class="label-text">PvP</span>
        <input type="checkbox" class="toggle mx-2" formControlName="useAiOpponent" />
        <span class="label-text">PvE</span>
      </label>
    </div>

    <div class="form-control">
      <label class="label cursor-pointer flex justify-center">
        <span class="label-text">Fixed Team</span>
        <input type="checkbox" class="toggle mx-2" formControlName="isRandomTeam" />
        <span class="label-text">Random Team</span>
      </label>
    </div>

    <button class="btn btn-primary" (click)="startDraft()" type="button">Start Draft</button>
  </form>

  <!-- DRAFT INTERFACE -->
  <div *ngIf="draftStarted">
    <h1 class="text-center text-2xl mb-4">{{ draftPhase }}</h1>

    <!-- BAN DASHBOARD -->
    <div class="flex">
      <ul class="flex">
        <li *ngFor="let champ of blueSideBans()" class="mx-2">
          <div class="avatar placeholder" *ngIf="champ?.isPlaceholder">
            <div class="w-12 rounded bg-blue-500 text-neutral-content">
              <span class="text-2xl">{{ champ.name }}</span>
            </div>
          </div>
          <div class="avatar" *ngIf="!champ?.isPlaceholder">
            <div class="w-12 rounded">
              <img [src]="champ.img" />
            </div>
          </div>
        </li>
      </ul>
      <label class="input input-bordered flex items-center gap-2 flex-1">
        <input type="text" class="grow" placeholder="Search" [formControl]="searchControl" id="searchControl" />
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4 opacity-70">
          <path
            fill-rule="evenodd"
            d="M9.965 11.026a5 5 0 1 1 1.06-1.06l2.755 2.754a.75.75 0 1 1-1.06 1.06l-2.755-2.754ZM10.5 7a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Z"
            clip-rule="evenodd" />
        </svg>
      </label>
      <ul class="flex">
        <li *ngFor="let champ of redSideBans()" class="mx-2">
          <div class="avatar placeholder" *ngIf="champ?.isPlaceholder">
            <div class="w-12 rounded bg-red-500 text-neutral-content">
              <span class="text-2xl">{{ champ.name }}</span>
            </div>
          </div>
          <div class="avatar" *ngIf="!champ?.isPlaceholder">
            <div class="w-12 rounded">
              <img [src]="champ.img" />
            </div>
          </div>
        </li>
      </ul>
    </div>

    <!-- Selected Champs and Table -->
    <div class="flex my-8 gap-4">
      <!-- BLUE SIDE -->
      <ul class="flex flex-col">
        <!-- EMPTY CHAMP SLOT -->
        <li *ngFor="let champ of blueSideChamps(); let i = index" class="my-4">
          <div class="relative" *ngIf="champ?.isPlaceholder">
            <div class="w-24 h-24 rounded bg-blue-500 text-neutral-content items-center justify-center flex">
              <span class="text-2xl">{{ champ.name }}</span>
            </div>
            <div class="absolute inset-0 flex items-end rounded overflow-hidden">
              <!-- Overlay content -->
              <ul class="flex" *ngIf="champ.name">
                <li *ngFor="let c of getTopChamps(champ.name, true)" class="h-6">
                  <img [src]="c.img" class="h-full w-full object-cover" />
                </li>
              </ul>
            </div>
          </div>
          <!-- FILLED CHAMP SLOT -->
          <div *ngIf="!champ?.isPlaceholder" class="avatar cursor-pointer">
            <div class="absolute right-full h-full w-6 mr-1">
              <ul>
                <li
                  *ngFor="let role of champ.roles"
                  class="w-6 aspect-square"
                  [class.bg-neutral-700]="role === champ.selectedRole"
                  (click)="selectRole(role, champ, true, i)">
                  <img [src]="'assets/images/role_icons/' + role + '.webp'" />
                </li>
              </ul>
            </div>
            <div class="relative w-24 rounded">
              <img [src]="champ.img" class="w-full" (click)="getChampionInfo(champ)" />
            </div>
          </div>
        </li>
      </ul>

      <!-- TABLE -->
      <div class="overflow-x-auto max-h-[68vh] flex-1">
        <table class="table table-pin-rows table-zebra">
          <thead>
            <tr>
              <th *ngFor="let header of headers">
                <div>
                  <span class="cursor-pointer">{{
                    draftPhase.includes('Ban') && header.name === 'Score' ? 'Ban Score' : header.name
                  }}</span>
                </div>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let champ of filteredChampions()" class="hover cursor-pointer" (click)="chooseChampion(champ)">
              <td>
                <div class="flex items-center gap-3">
                  <div class="avatar">
                    <div class="rounded w-12">
                      <img [src]="champ.img" [alt]="champ.name" />
                    </div>
                  </div>
                  <div>
                    <div class="font-bold">{{ champ.name }}</div>
                  </div>
                  <ul class="flex">
                    <li *ngFor="let role of champ.roles" class="flex flex-col items-center w-8">
                      <img [src]="'assets/images/role_icons/' + role + '.webp'" />
                    </li>
                  </ul>
                </div>
              </td>
              <td>{{ getLetterRank(getPickScore(champ)) }}</td>
              <td>
                <span *ngFor="let role of champ.roles; let i = index">
                  {{ getLetterRank(getMetaScore(champ, role)) }}
                  <span *ngIf="i < champ.roles.length - 1"> / </span>
                </span>
              </td>
              <td>
                <span *ngFor="let role of champ.roles; let i = index">
                  {{ getLetterRank(getMasteryScore(champ, role)) }}
                  <span *ngIf="i < champ.roles.length - 1"> / </span>
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- RED SIDE -->
      <ul class="flex flex-col">
        <li *ngFor="let champ of redSideChamps(); let i = index" class="my-4">
          <!-- EMPTY CHAMP SLOT -->
          <div class="relative" *ngIf="champ?.isPlaceholder">
            <div class="w-24 h-24 rounded bg-red-500 text-neutral-content items-center justify-center flex">
              <span class="text-2xl">{{ champ.name }}</span>
            </div>
            <div class="absolute inset-0 flex items-end rounded overflow-hidden">
              <!-- Overlay content -->
              <ul class="flex" *ngIf="champ.name">
                <li *ngFor="let c of getTopChamps(champ.name, false)" class="h-6">
                  <img [src]="c.img" class="h-full w-full object-cover" />
                </li>
              </ul>
            </div>
          </div>
          <!-- FILLED CHAMP SLOT -->
          <div *ngIf="!champ?.isPlaceholder" class="avatar cursor-pointer">
            <div class="absolute left-full h-full w-6 ml-1">
              <ul>
                <li
                  *ngFor="let role of champ.roles"
                  class="w-6 aspect-square"
                  [class.bg-neutral-700]="role === champ.selectedRole"
                  (click)="selectRole(role, champ, false, i)">
                  <img [src]="'assets/images/role_icons/' + role + '.webp'" />
                </li>
              </ul>
            </div>
            <div class="relative w-24 rounded">
              <img [src]="champ.img" class="w-full" (click)="getChampionInfo(champ)" />
            </div>
          </div>
        </li>
      </ul>
    </div>
    <!-- ADVICE ON DRAFT FOR BOTH SIDES -->
    <div class="flex justify-between mb-8">
      <div class="p-4 bg-blue-400 rounded-lg">
        <h2 class="mb-2">Blue Side</h2>
        <ul>
          <li *ngFor="let item of getCompositionAdvice(true)" class="mb-1">
            {{ item }}
          </li>
        </ul>
      </div>
      <div class="text-right p-4 bg-red-400 rounded-lg">
        <h2 class="mb-2">Red Side</h2>
        <ul>
          <li *ngFor="let item of getCompositionAdvice(false)" class="mb-1">
            {{ item }}
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
