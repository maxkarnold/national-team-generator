<header class="mobile">
    <mat-toolbar color="primary">
        <span>National Team Generator</span> 
        <span class="nav-spacer"></span>
        <button mat-icon-button class="example-icon" aria-label="Example icon-button with menu icon" (click)="navToggle = !navToggle" >
            <mat-icon>menu</mat-icon>
        </button>
    </mat-toolbar>
    <mat-nav-list class="primaryColorBG list" role="list" *ngIf="navToggle">
        <a mat-list-item href="#" class="nav-item" (click)="loginOverlay()" *ngIf="!isLoggedIn" cdkOverlayOrigin #trigger="cdkOverlayOrigin">Login</a>
        <a mat-list-item href="#" class="nav-item" (click)="logout()" *ngIf="isLoggedIn">Logout</a>
        <a mat-list-item href="#full_roster_heading" class="nav-item">Go to Full Roster</a>
    </mat-nav-list>
</header>
<header class="desktop">
    <mat-toolbar color="primary">
        <span>National Team Generator</span> 
        <span class="nav-spacer"></span>
        <a href="#" (click)="loginOverlay()" *ngIf="!isLoggedIn"><span>Login</span></a>
        <a href="#" (click)="logout()" *ngIf="isLoggedIn"><span>Logout</span></a>
        <a href="#full_roster_heading"><span>Full Roster</span></a>
    </mat-toolbar>
</header>

<ng-container *ngIf="loginOverlayOpen">
    <div class="login-overlay">
        <div class="exit-container">
            <button mat-button (click)="loginOverlay()" ><mat-icon>close</mat-icon></button>
        </div>
        <input type="text" #email placeholder="email">
        <input type="password" #password placeholder="password">
        <button mat-raised-button type="submit" (click)="login(email.value, password.value)" class="login-button">Login</button>
    </div>
</ng-container>
<div class="page-container">
    <div class="buttons-container">
        <mat-form-field class="team-generator-form">
            <mat-label>-- Choose a Nation --</mat-label>  
            <mat-select #nationSelect appearance="fill" [(value)]="nationSelectValue" class="select-nations" (click)="consoleLog(nationSelectValue)">
                <mat-optgroup *ngFor="let tierGroup of this.nations" [label]="tierGroup.tier">
                    <mat-option [value]="tierGroup.tier" class="nation-option">
                        Random Nationalities
                    </mat-option>
                    <mat-option *ngFor="let nation of tierGroup.nations" [value]="nation.name" class="nation-option">
                        <img [src]="nation.logo" alt=""> {{nation.name}}
                    </mat-option>
                </mat-optgroup>
            </mat-select>
        </mat-form-field>
        <div class="form-buttons">
            <button mat-raised-button color="primary" class="generate" type="button" (click)="getPlayers()">Generate</button>
            <div class="load-data-buttons">
                <button mat-raised-button color="primary" class="load-button" type="button" (click)="saveDataOverlay()" cdkOverlayOrigin #trigger="cdkOverlayOrigin">Load</button>
                <button mat-raised-button color="warn" *ngIf="saveDataOverlayOpen" type="button" (click)="closeSaveDataOverlay()" cdkOverlayOrigin #trigger="cdkOverlayOrigin">Close Overlay</button>
            </div>
        </div>
        <div class="save-buttons" *ngIf="players.length > 0">
            <button class="save-button" type="button" (click)="savePlayers('firestore')" mat-raised-button color="primary">Save to Cloud</button>
            <button class="save-button" type="button" (click)="savePlayers('localStorage')" mat-raised-button color="primary">Save to Local Storage</button>
        </div>
        <ng-template cdkConnectedOverlay [cdkConnectedOverlayOrigin]="trigger" [cdkConnectedOverlayOpen]="saveDataOverlayOpen">
            <ul class="load-roster-overlay">
                <li>
                    <button type="button" (click)="loadPlayers('loadLocalStorage')">Load from local storage</button>
                </li>
                <li>
                    <button type="button" (click)="saveDataOverlay('check')">Check cloud saved data</button>
                </li>
                <ul>Save Data Ids:
                    <li *ngFor="let data of savedData">
                        <button type="button" (click)="loadPlayers(data.id)">{{data.id}}</button>
                    </li>
                </ul>
            </ul>
        </ng-template>
        <div class="instructions">
            <div class="info">
                <button mat-raised-button type="button" color="accent" (click)="infoOverlay()" *ngIf="!instructionsOpen" cdkOverlayOrigin #trigger="cdkOverlayOrigin">Instructions</button>
                <button mat-raised-button type="button" color="accent" (click)="infoOverlay()" *ngIf="instructionsOpen" cdkOverlayOrigin #trigger="cdkOverlayOrigin">Close Instructions</button>
                <ng-template  cdkConnectedOverlay [cdkConnectedOverlayOrigin]="trigger" [cdkConnectedOverlayOpen]="instructionsOpen">
                        <div class="info-overlay">
                            <div class="exit-container">
                                <button mat-button (click)="infoOverlay()" ><mat-icon>close</mat-icon></button>
                            </div>
                            <p>
                                Drag and drop players from the bench to the pitch. Players have ratings based on their positions. The box that highlights in green is the best position for a player. The box that highlights yellow is an alternate position (-5 rating). 
                                The box that highlights red is not a viable position (-20 rating).
                            </p>
                            
                        </div>
                </ng-template>
            </div>
            <div class="rules">
                <h4 class="rules-heading">Squad Rules</h4>
                <hr>
                <ul>
                    <li *ngFor="let rule of squadRules"><span>{{rule.check}}</span> {{rule.text}}</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="formation" *ngIf="this.pitchPlayers.length > 0">Formation: {{formation}}</div>
    <div class="tactics-container" cdkDropListGroup>
        <div class="pitch-container">   
            <div class="starters-total-rating" *ngIf="this.pitchPlayers.length > 0">Avg Rating {{startersTotalRating}}</div>
            <div class="squad-total-rating" *ngIf="checkFormation()">Squad Rating {{squadTotalRating}}</div>
            <button mat-raised-button color="primary" type="button" (click)="resetStarters()" class="reset-button">Reset XI</button>
            <div class="pitch-borders">
                <div class="goal-box-top pitch-divs"></div>
                <div class="goal-box-circle-top pitch-divs"></div>
                <div class="pitch-dot pitch-divs"></div>
                <div class="pitch-circle pitch-divs"></div>
                <div class="half-line pitch-divs"></div>
                <div class="goal-box-circle-bottom pitch-divs"></div>
                <div class="goal-box-bottom pitch-divs"></div>
                <div class="pitch-grid">
                    <div *ngFor="let box of positionBoxes" [class]="getPositionBoxes(box)" cdkDropList (cdkDropListDropped)="drop($event)" [cdkDropListData]="pitchPlayers">
                        <div [class]="getPlayerClass(box)" cdkDrag [cdkDragData]="box" (cdkDragStarted)="getPositionOutline($event)" (cdkDragReleased)="removeOutlineRelease($event)" (cdkDragDropped)="removeOutlineDrop($event)">
                            <div *ngIf="box.pitchPlayer !== undefined">
                                <img [src]="box.pitchPlayer.playerFace" alt="" class="player-face">
                                <span *ngIf="box.pitchPlayer !== undefined" class="pitch-player-info">{{box.pitchPlayer.pitchRating}}</span>
                                <span *ngIf="box.pitchPlayer !== undefined" class="pitch-player-info">{{box.pitchPlayer.pitchPosition}}</span>
                                <img *ngIf="box.pitchPlayer !== undefined" class="pitch-player-img" [src]="box.pitchPlayer.nationalityLogo">
                                <img *ngIf="box.pitchPlayer !== undefined" class="pitch-player-img" [src]="box.pitchPlayer.clubLogo">
                                <span *ngIf="box.pitchPlayer !== undefined" class="player-name">{{box.pitchPlayer.displayName}}</span>
                            </div>
                            
                            <!-- <div *cdkDragPreview  class="player-box active">
                                    <img [src]="box.pitchPlayer.playerFace" alt="" class="player-face" *ngIf="box.pitchPlayer !== undefined">
                                    <span *ngIf="box.pitchPlayer !== undefined" class="pitch-player-info">{{box.pitchPlayer.pitchRating}}</span>
                                    <span *ngIf="box.pitchPlayer !== undefined" class="pitch-player-info">{{box.pitchPlayer.pitchPosition}}</span>
                                    <img *ngIf="box.pitchPlayer !== undefined" class="pitch-player-img" [src]="box.pitchPlayer.nationalityLogo">
                                    <img *ngIf="box.pitchPlayer !== undefined" class="pitch-player-img" [src]="box.pitchPlayer.clubLogo">
                                    <span *ngIf="box.pitchPlayer !== undefined" class="player-name">{{box.pitchPlayer.displayName}}</span>
                            </div>    -->
                            <!-- <div class="player-box active" *cdkDragPlaceholder>Placeholder</div> -->
                        </div>
                        <div [class]="getPosBoxClass(box)">
                        </div>
                    </div>
                </div> 
            </div> 
        </div>
        <div class="lineup-container">
            <h2>Roster</h2>
            <!-- GRID VERSION -->
            <div class="lineup-grid">
                <ul class="lineup-headers">
                    <li class="name-header">Name</li>
                    <li>Position</li>
                    <li>Age</li>
                    <li>Rating</li>
                </ul>
                <div class="lineup-spots">
                    <ul class="pitch-players">
                        <li class="header">Pos</li>
                        <li *ngFor="let pos of pitchPlayers">{{pos.pitchPosition}}</li>
                    </ul>
                    <ul class="bench">
                        <li>Sub 1</li>
                        <li>Sub 2</li>
                        <li>Sub 3</li>
                        <li>Sub 4</li>
                        <li>Sub 5</li>
                        <li>Sub 6</li>
                        <li>Sub 7</li>
                        <li>Sub 8</li>
                        <li>Sub 9</li>
                        <li>Sub 10</li>
                        <li>Sub 11</li>
                        <li>Sub 12</li>
                    </ul>
                    <ul class="reserves">
                        <li *ngFor="let player of players.slice(12); let i = index">{{i + 24}}</li>
                    </ul>
                </div>
                <div class="players-container">
                    <mat-accordion multi>
                        <div class="starters-container">
                            <mat-expansion-panel *ngFor="let player of sortedPitchPlayers">
                                <mat-expansion-panel-header>
                                    <ul class="player-row">
                                        <li class="name-cell">{{player.firstInitial}}. {{player.lastName}}</li>
                                        <li>{{player.position}}</li>
                                        <li>{{player.age}}</li>
                                        <li>{{player.rating}}</li>
                                        <!-- <li *cdkDragPreview>
                                            <img class="shirtIcon-img" [src]="shirtIcon" [alt]="">
                                            <div class="player-preview">{{player.lastName}} {{player.position}} {{player.rating}}</div>
                                        </li> -->
                                    </ul>
                                </mat-expansion-panel-header>
                                <p class="expanded-info">
                                    <span>Full Name:</span><span>{{player.firstName}} {{player.lastName}}</span>
                                </p>
                                <p class="expanded-info">
                                    <span>Preferred Role/Duty:</span><span>{{player.preferredRole}} - {{player.preferredDuty}}</span>
                                </p>
                                <p class="expanded-info">
                                    <span>Other Positions:</span><span *ngFor="let pos of player.altPositions">{{pos}}</span>
                                </p>
                                <p class="expanded-info">
                                    <span>Club:</span>
                                    <span>
                                        <img [src]="player.clubLogo" [alt]="player.club">
                                        <span>{{player.club}}</span>
                                    </span>
                                </p>
                                <p class="expanded-info">
                                    <span>Nationality:</span>
                                    <span>
                                        <img [src]="player.nationalityLogo" alt="">
                                        <span>{{player.nationality}}</span>
                                    </span>
                    
                                </p>
                                <p class="expanded-info">
                                    <span>Preferred Foot:</span><span>{{player.foot}}</span>
                                </p>
                                
                            </mat-expansion-panel>
                        </div>
                        <div class="bench-container" cdkDropList id="bench-players" [cdkDropListData]="players" (cdkDropListDropped)="drop($event)" >
                            <mat-expansion-panel *ngFor="let player of players" cdkDrag [cdkDragData]="player" (cdkDragStarted)="getPositionOutline($event)" (cdkDragReleased)="removeOutlineRelease($event)" (cdkDragDropped)="removeOutlineDrop($event)">
                                <mat-expansion-panel-header>
                                    <ul class="player-row">
                                        <li class="name-cell">{{player.firstInitial}}. {{player.lastName}}</li>
                                        <li>{{player.position}}</li>
                                        <li>{{player.age}}</li>
                                        <li>{{player.rating}}</li>
                                        <li *cdkDragPreview>
                                            <!-- <img class="shirtIcon-img" [src]="shirtIcon" [alt]=""> -->
                                            <div class="player-preview">{{player.lastName}} {{player.position}} {{player.rating}}</div>
                                        </li>
                                    </ul>
                                </mat-expansion-panel-header>
                                    <p class="expanded-info">
                                        <span>Full Name:</span><span>{{player.firstName}} {{player.lastName}}</span>
                                    </p>
                                    <p class="expanded-info">
                                        <span>Preferred Role/Duty:</span><span>{{player.preferredRole}} - {{player.preferredDuty}}</span>
                                    </p>
                                    <p class="expanded-info">
                                        <span>Other Positions:</span><span *ngFor="let pos of player.altPositions">{{pos}}</span>
                                    </p>
                                    <p class="expanded-info">
                                        <span>Club:</span>
                                        <span>
                                            <img [src]="player.clubLogo" [alt]="player.club">
                                            <span>{{player.club}}</span>
                                        </span>
                                    </p>
                                    <p class="expanded-info">
                                        <span>Nationality:</span>
                                        <span>
                                            <img [src]="player.nationalityLogo" alt="">
                                            <span>{{player.nationality}}</span>
                                        </span>
                                    </p>
                                    <p class="expanded-info">
                                        <span>Preferred Foot:</span><span>{{player.foot}}</span>
                                    </p> 
                                    <div class="lineup-drag-placeholder" *cdkDragPlaceholder>{{player.firstInitial}}. {{player.lastName}} {{player.rating}} {{player.position}}</div>
                            </mat-expansion-panel>
                        </div>
                    </mat-accordion>       
                </div> 
            </div>
        </div>
    </div>
    <div class="display-container" *ngIf="players.length > 0"> 
        <h2 id="full_roster_heading">Full Roster</h2>
        <div class="position-table">
            <h3>Position Breakdown</h3>
            <ul class="positions">
                <li *ngFor="let pos of positions"><span>{{pos.position}}</span><span>{{pos.amount}}</span></li>
            </ul>
        </div>
        <h2 class="nation-name-heading">{{nationName}} Team</h2> 
        <h3>Player Table</h3>
        <table class="player-table" matSort (matSortChange)="sortData($event)">     
            <tr class="table-headings">
                <!-- <th>Index</th> -->
                <th mat-sort-header="name">Name</th>
                <th mat-sort-header="club">Club</th>
                <th mat-sort-header="nationality" class="desktop">Nationality</th>
                <th mat-sort-header="roleDuty" class="desktop">Preferred Role/Duty</th>
                <th mat-sort-header="pos">Position</th>
                <th mat-sort-header="altPositions" class="desktop">Other Positions</th>
                <th mat-sort-header="foot" class="desktop">Preferred Foot</th>
                <th mat-sort-header="rating">Rating</th>
                <th mat-sort-header="age">Age</th> 
            </tr> 
            <tbody> 
                <tr *ngFor="let player of sortedData" class="player-row">
                    <td>{{player.firstName}} {{player.lastName}}</td>
                    <td>
                        <div>
                            <img [src]="player.clubLogo" [alt]="player.club" class="club-logo">
                            <span>{{player.club}}</span>
                        </div>              
                    </td>
                    <td class="desktop">
                        <div>
                            <img [src]="player.nationalityLogo" alt="">
                            <span>{{player.nationality}}</span>
                        </div>  
                    </td>
                    <td class="desktop">{{player.preferredRole}} - {{player.preferredDuty}}</td>
                    <td>{{player.position}}</td> 
                    <td class="alt-positions desktop">
                        <div>
                            <span *ngFor="let pos of player.altPositions">{{pos}}</span>
                        </div>
                    </td>
                    <td class="desktop">{{player.foot}}</td>
                    <td>{{player.rating}}</td>
                    <td>{{player.age}}</td>
                </tr>
            </tbody>
        </table> 
    </div>
</div>

